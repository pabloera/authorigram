# Pipeline Bolsonarismo v4.9.8 - Dashboard Funcional com Corre√ß√µes Cr√≠ticas üöÄ

> **An√°lise de Discurso Pol√≠tico Brasileiro com Intelig√™ncia Artificial**
> 
> Pipeline unificado ultra-robusto para an√°lise de mensagens do Telegram (2019-2023) focado em bolsonarismo, negacionismo e autoritarismo digital.
> 
> **v4.9.8 - Junho 2025**: üéØ DASHBOARD FUNCIONAL com corre√ß√µes cr√≠ticas implementadas! An√°lise temporal corrigida, erro `dropna=False` resolvido, 4 n√≠veis pol√≠ticos funcionais, 2 clusters sem√¢nticos identificados. Pipeline 22 etapas + Dashboard 100% operacional com 300 registros validados.

## üö® **IN√çCIO R√ÅPIDO - LEIA PRIMEIRO!**

### ‚ö° **Setup Inicial**
```bash
# 1. Configurar ambiente
cp config/anthropic.yaml.template config/anthropic.yaml
cp config/voyage_embeddings.yaml.template config/voyage_embeddings.yaml

# 2. Configurar APIs
echo "ANTHROPIC_API_KEY=sk-ant-api03-[SUA_CHAVE]" > .env
echo "VOYAGE_API_KEY=pa-[SUA_CHAVE]" >> .env

# 3. Executar pipeline completo
python run_pipeline.py

# 4. Iniciar dashboard (opcional)
cd src/dashboard && python start_dashboard.py
```

### ‚ú® **Caracter√≠sticas v4.9.8 - DASHBOARD FUNCIONAL COM CORRE√á√ïES CR√çTICAS**
- üî¢ **22 Etapas Implementadas**: Pipeline expandido (01-20 + 04b/06b)
- üéØ **100% Padr√µes Anthropic**: XML prompting, Haiku model, taxonomia hier√°rquica
- ‚ö° **Enhanced Components**: Encoding, deduplication, text cleaning, statistical analysis
- üöÄ **Voyage.ai Integrado**: 4 est√°gios com embeddings sem√¢nticos otimizados
- üî§ **spaCy NLP**: Processamento lingu√≠stico avan√ßado com pt_core_news_lg
- üí∞ **96%+ Economia**: Custos API drasticamente reduzidos (1.3M ‚Üí 50K)
- üéõÔ∏è **API-only Stages 12-20**: Sem fallbacks, m√°xima qualidade
- üìä **Dashboard Integrado**: Interface web completa

---

## üéØ **M√ìDULOS DO PIPELINE COMPLETOS (22 ETAPAS)**

### üìÅ **Estrutura Principal**
```
src/
‚îú‚îÄ‚îÄ main.py                           # Controlador principal com checkpoints
‚îú‚îÄ‚îÄ anthropic_integration/
‚îÇ   ‚îú‚îÄ‚îÄ unified_pipeline.py          # Engine principal (22 etapas)
‚îÇ   ‚îú‚îÄ‚îÄ base.py                      # Classe base Anthropic
‚îÇ   ‚îú‚îÄ‚îÄ political_analyzer.py        # Stage 05 - An√°lise Pol√≠tica Enhanced
‚îÇ   ‚îú‚îÄ‚îÄ sentiment_analyzer.py        # Stage 08 - An√°lise de Sentimentos
‚îÇ   ‚îú‚îÄ‚îÄ voyage_topic_modeler.py      # Stage 09 - Topic Modeling
‚îÇ   ‚îú‚îÄ‚îÄ semantic_tfidf_analyzer.py   # Stage 10 - TF-IDF Sem√¢ntico
‚îÇ   ‚îú‚îÄ‚îÄ voyage_clustering_analyzer.py # Stage 11 - Clustering
‚îÇ   ‚îú‚îÄ‚îÄ semantic_search_engine.py    # Stage 19 - Busca Sem√¢ntica
‚îÇ   ‚îú‚îÄ‚îÄ spacy_nlp_processor.py       # Stage 07 - Processamento Lingu√≠stico
‚îÇ   ‚îú‚îÄ‚îÄ encoding_validator.py        # Stage 02 - Enhanced Encoding
‚îÇ   ‚îú‚îÄ‚îÄ deduplication_validator.py   # Stage 03 - Global Deduplication
‚îÇ   ‚îú‚îÄ‚îÄ statistical_analyzer.py      # Stage 04b/06b - An√°lise Estat√≠stica
‚îÇ   ‚îú‚îÄ‚îÄ intelligent_text_cleaner.py  # Stage 06 - Enhanced Text Cleaning
‚îÇ   ‚îú‚îÄ‚îÄ performance_optimizer.py     # Otimiza√ß√£o de Performance
‚îÇ   ‚îî‚îÄ‚îÄ [15+ outros m√≥dulos AI]
‚îî‚îÄ‚îÄ dashboard/
    ‚îú‚îÄ‚îÄ app.py                       # Interface Web Principal
    ‚îú‚îÄ‚îÄ csv_parser.py               # Parser CSV Integrado
    ‚îî‚îÄ‚îÄ start_dashboard.py          # Iniciador Dashboard
```

### üîÑ **Pipeline Completo (22 Etapas)**

| Stage | Nome | Arquivo | Tecnologia | Status |
|-------|------|---------|------------|--------|
| **01** | Chunk Processing | `unified_pipeline.py` | - | ‚úÖ Conclu√≠do |
| **02** | Enhanced Encoding | `encoding_validator.py` | chardet + AI | ‚úÖ Enhanced |
| **03** | Global Deduplication | `deduplication_validator.py` | AI | ‚úÖ Enhanced |
| **04** | Feature Validation | `unified_pipeline.py` | - | ‚úÖ Conclu√≠do |
| **04b** | Statistical Analysis (Pre) | `statistical_analyzer.py` | - | ‚úÖ Enhanced |
| **05** | Political Analysis | `political_analyzer.py` | Anthropic Enhanced | ‚úÖ API-only |
| **06** | Enhanced Text Cleaning | `intelligent_text_cleaner.py` | AI | ‚úÖ Enhanced |
| **06b** | Statistical Analysis (Post) | `statistical_analyzer.py` | - | ‚úÖ Enhanced |
| **07** | Linguistic Processing | `spacy_nlp_processor.py` | spaCy pt_core_news_lg | ‚úÖ Ativo |
| **08** | Sentiment Analysis | `sentiment_analyzer.py` | Anthropic | ‚úÖ API-only |
| **09** | Topic Modeling | `voyage_topic_modeler.py` | Voyage.ai | ‚úÖ API-only |
| **10** | TF-IDF Extraction | `semantic_tfidf_analyzer.py` | Voyage.ai | ‚úÖ API-only |
| **11** | Clustering | `voyage_clustering_analyzer.py` | Voyage.ai | ‚úÖ API-only |
| **12** | Hashtag Normalization | `unified_pipeline.py` | Anthropic | ‚úÖ API-only |
| **13** | Domain Analysis | `unified_pipeline.py` | Anthropic | ‚úÖ API-only |
| **14** | Temporal Analysis | `unified_pipeline.py` | Anthropic | ‚úÖ API-only |
| **15** | Network Analysis | `unified_pipeline.py` | Anthropic | ‚úÖ API-only |
| **16** | Qualitative Analysis | `unified_pipeline.py` | Anthropic | ‚úÖ API-only |
| **17** | Smart Pipeline Review | `unified_pipeline.py` | Anthropic | ‚úÖ API-only |
| **18** | Topic Interpretation | `unified_pipeline.py` | Anthropic | ‚úÖ API-only |
| **19** | Semantic Search | `semantic_search_engine.py` | Voyage.ai | ‚úÖ API-only |
| **20** | Pipeline Validation | `unified_pipeline.py` | Anthropic | ‚úÖ API-only |

---

## üéõÔ∏è **COMANDOS PRINCIPAIS**

### **Execu√ß√£o Completa**
```bash
# Pipeline completo (22 etapas)
python run_pipeline.py

# Com dataset espec√≠fico
python run_pipeline.py --dataset "data/uploads/meu_dataset.csv"

# Com logging detalhado
python run_pipeline.py --verbose

# For√ßar rein√≠cio sem checkpoints
python run_pipeline.py --force-restart
```

### **Execu√ß√£o Seletiva**
```bash
# Executar a partir de uma etapa espec√≠fica
python src/main.py --start-from 08_sentiment_analysis

# Executar etapa individual
python src/main.py --stage 05_political_analysis

# Executar apenas etapas Anthropic
python src/main.py --anthropic-only

# Executar apenas etapas Voyage.ai
python src/main.py --voyage-only
```

### **Diagn√≥stico e Manuten√ß√£o**
```bash
# Verificar status do pipeline
python run_pipeline.py --status

# Limpar checkpoints e recome√ßar
python run_pipeline.py --clean

# Verificar depend√™ncias
python run_pipeline.py --check-deps

# Relat√≥rio de custos
python -c "from src.anthropic_integration.cost_monitor import get_cost_report; print(get_cost_report())"
```

### **üîÑ Recovery e Troubleshooting**

#### **Cen√°rios de Recovery**
```bash
# 1. Pipeline travou em alguma etapa
python run_pipeline.py --recover

# 2. Erro de API (Anthropic/Voyage)
python run_pipeline.py --retry-failed

# 3. Problema de mem√≥ria
python run_pipeline.py --low-memory

# 4. Corrup√ß√£o de dados
python run_pipeline.py --validate-and-fix

# 5. Reset completo
python run_pipeline.py --reset-all
rm -rf checkpoints/* logs/* data/interim/*
```

#### **Monitoramento em Tempo Real**
```bash
# Logs em tempo real
tail -f logs/pipeline_execution.log

# Status de checkpoints
watch -n 5 "ls -la checkpoints/"

# Monitoramento de custos
python -c "from src.anthropic_integration.cost_monitor import monitor_realtime; monitor_realtime()"
```

---

## ‚öôÔ∏è **CONFIGURA√á√ÉO COMPLETA**

### üìã **Depend√™ncias**

#### **Python Packages (requirements.txt)**
```bash
# APIs Principais
anthropic>=0.25.0
voyageai>=0.2.0

# Processamento de Dados
pandas>=2.0.0
numpy>=1.24.0
scikit-learn>=1.3.0

# NLP e Embeddings
spacy>=3.7.0
sentence-transformers>=2.2.0

# Detec√ß√£o de Encoding
chardet>=5.0.0
charset-normalizer>=3.0.0

# Clustering e Similaridade  
faiss-cpu>=1.7.0
umap-learn>=0.5.0

# Web Dashboard
streamlit>=1.28.0
plotly>=5.17.0

# Configura√ß√£o
pyyaml>=6.0
python-dotenv>=1.0.0

# Logging e Monitoramento
loguru>=0.7.0
tqdm>=4.65.0
```

#### **Modelos spaCy**
```bash
# Instalar modelo portugu√™s
python -m spacy download pt_core_news_lg
```

#### **APIs Externas**
- **Anthropic API**: claude-3-5-haiku-20241022
- **Voyage.ai API**: voyage-3.5-lite (96% economia ativada)

### üîß **Configura√ß√£o de Arquivos**

#### **1. Vari√°veis de Ambiente (.env)**
```bash
# APIs (OBRIGAT√ìRIO)
ANTHROPIC_API_KEY=sk-ant-api03-[SUA_CHAVE_AQUI]
VOYAGE_API_KEY=pa-[SUA_CHAVE_AQUI]

# Modelos (OPCIONAL)
ANTHROPIC_MODEL=claude-3-5-haiku-20241022
VOYAGE_MODEL=voyage-3.5-lite

# Performance (OPCIONAL)
MAX_WORKERS=4
CHUNK_SIZE=10000
MEMORY_LIMIT=2GB

# Debug (OPCIONAL)
DEBUG_MODE=false
LOG_LEVEL=INFO
COST_MONITORING=true
```

#### **2. Configura√ß√£o Principal (config/settings.yaml)**
```yaml
# Configura√ß√£o atualizada para v4.9.1
project:
  name: "dataanalysis-bolsonarismo"
  version: "4.9.1"
  
# APIs
anthropic:
  model: "claude-3-5-haiku-20241022"
  max_tokens: 4000
  temperature: 0.3
  cost_monitoring: true

voyage:
  model: "voyage-3.5-lite"
  batch_size: 128
  cache_enabled: true

# Pipeline
processing:
  chunk_size: 10000
  max_workers: 4
  memory_limit: "2GB"
  
# Otimiza√ß√µes
optimizations:
  sampling_enabled: true
  cost_reduction_target: 0.96
  fallback_strategies: true
```

#### **3. Configura√ß√£o Anthropic (config/anthropic.yaml)**
```yaml
# Configura√ß√£o espec√≠fica Anthropic Enhanced
api:
  model: "claude-3-5-haiku-20241022"
  max_tokens: 4000
  temperature: 0.3
  
# Padr√µes Anthropic Implementados
features:
  xml_structured_prompting: true
  hierarchical_taxonomy: true
  pydantic_validation: true
  concurrent_processing: true
  rag_integration: true
  fallback_strategies: true
  token_control: true
  experiment_control: true
```

#### **4. Configura√ß√£o Voyage (config/voyage_embeddings.yaml)**
```yaml
# Configura√ß√£o Voyage.ai otimizada
api:
  model: "voyage-3.5-lite"
  batch_size: 128
  max_tokens: 32000
  
# Integra√ß√µes ativas
integration:
  topic_modeling: true      # Stage 09
  tfidf_analysis: true      # Stage 10  
  clustering: true          # Stage 11
  semantic_search: true     # Stage 19
  
# Otimiza√ß√µes
cost_optimization:
  sampling_enabled: true
  reduction_target: 0.96
  threshold: 0.75
```

### üèóÔ∏è **Estrutura de Diret√≥rios**
```
dataanalysis-bolsonarismo/
‚îú‚îÄ‚îÄ .env                          # Vari√°veis de ambiente
‚îú‚îÄ‚îÄ run_pipeline.py              # Executor principal
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.py                  # Controlador com checkpoints
‚îÇ   ‚îú‚îÄ‚îÄ anthropic_integration/   # 22+ m√≥dulos AI
‚îÇ   ‚îî‚îÄ‚îÄ dashboard/              # Interface web
‚îú‚îÄ‚îÄ config/                     # Configura√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ settings.yaml           # Configura√ß√£o principal
‚îÇ   ‚îú‚îÄ‚îÄ anthropic.yaml          # Config Anthropic
‚îÇ   ‚îî‚îÄ‚îÄ voyage_embeddings.yaml  # Config Voyage
‚îú‚îÄ‚îÄ data/                       # Dados
‚îÇ   ‚îú‚îÄ‚îÄ uploads/               # Datasets de entrada
‚îÇ   ‚îú‚îÄ‚îÄ interim/               # Processamento intermedi√°rio
‚îÇ   ‚îî‚îÄ‚îÄ dashboard_results/     # Resultados dashboard
‚îú‚îÄ‚îÄ checkpoints/               # Checkpoints pipeline
‚îú‚îÄ‚îÄ logs/                      # Logs do sistema
‚îî‚îÄ‚îÄ docs/                      # Documenta√ß√£o adicional
```

---

## üìà **Caracter√≠sticas T√©cnicas v4.9.1**

### üéØ **Otimiza√ß√µes Implementadas**
- **96% Economia de Custos**: Sampling inteligente (1.3M ‚Üí 50K registros)
- **API-only Stages 12-20**: Sem fallbacks, m√°xima qualidade
- **Enhanced Performance**: Otimiza√ß√µes espec√≠ficas por etapa
- **Result Extension**: Manuten√ß√£o da completude do dataset
- **Concurrent Processing**: Processamento paralelo com sem√°foros

### üî¨ **An√°lises Dispon√≠veis**
- **An√°lise Pol√≠tica Enhanced**: Taxonomia hier√°rquica brasileira
- **Sentiment Analysis**: Multi-dimensional contextualizada
- **Topic Modeling**: Interpreta√ß√£o sem√¢ntica com Voyage.ai
- **Network Analysis**: Detec√ß√£o de coordena√ß√£o e influ√™ncia
- **Qualitative Analysis**: Classifica√ß√£o de narrativas e frames
- **Temporal Analysis**: Evolu√ß√£o discursiva e marcos hist√≥ricos

### üìä **M√©tricas e Monitoramento**
- **Cost Monitoring**: Tracking em tempo real de custos API
- **Quality Metrics**: Scores de qualidade por etapa
- **Performance Tracking**: Tempos de execu√ß√£o e otimiza√ß√µes
- **Error Handling**: Logs detalhados e recovery autom√°tico

---

## üö® **Troubleshooting**

### ‚ö†Ô∏è **Problemas Comuns**

#### **Erro de API**
```bash
# Verificar configura√ß√£o
python -c "import os; print('ANTHROPIC_API_KEY:', os.getenv('ANTHROPIC_API_KEY')[:10] + '...')"

# Testar conectividade
python -c "from src.anthropic_integration.base import AnthropicBase; AnthropicBase({}).test_connection()"
```

#### **Problema de Mem√≥ria**
```bash
# Executar com menor chunk size
export CHUNK_SIZE=5000
python run_pipeline.py --low-memory
```

#### **Falha em Etapa Espec√≠fica**
```bash
# Ver logs espec√≠ficos
grep "Stage 05" logs/pipeline_execution.log

# Reiniciar da etapa
python src/main.py --start-from 05_political_analysis
```

### üîß **Comandos de Diagn√≥stico**
```bash
# Status completo do sistema
python run_pipeline.py --health-check

# Validar configura√ß√µes
python run_pipeline.py --validate-config

# Limpar cache corrompido
python run_pipeline.py --clear-cache

# Verificar depend√™ncias
python run_pipeline.py --check-dependencies
```

---

## üéì **Contexto Cient√≠fico**

### **Per√≠odo Analisado: 2019-2023**
- **Governo Bolsonaro** (2019-2022)
- **Pandemia COVID-19** (2020-2022)
- **Elei√ß√µes Presidenciais** (2022)
- **Transi√ß√£o Governamental** (2022-2023)

### **Fen√¥menos Estudados**
- **Bolsonarismo** e extrema-direita digital
- **Negacionismo cient√≠fico** e hist√≥rico
- **Autoritarismo** e ataques √† democracia
- **Desinforma√ß√£o** e teorias conspirat√≥rias
- **Polariza√ß√£o pol√≠tica** nas redes

### **Metodologia AI-Enhanced**
- **An√°lise sem√¢ntica** contextualizada
- **Classifica√ß√£o autom√°tica** de narrativas
- **Detec√ß√£o de padr√µes** autorit√°rios
- **Interpreta√ß√£o qualitativa** inteligente

---

## üõ†Ô∏è **Desenvolvimento**

### **Princ√≠pios da Arquitetura**

1. **Centraliza√ß√£o Absoluta**: Um comando, uma configura√ß√£o, um ponto de manuten√ß√£o
2. **AI como Padr√£o**: Anthropic API para todas as an√°lises complexas
3. **Voyage.ai Integration**: Embeddings sem√¢nticos para an√°lises avan√ßadas
4. **Contexto Brasileiro**: Prompts especializados em pol√≠tica nacional

### **Padr√£o de Implementa√ß√£o**

```python
# Todos os stages 12-20 seguem este padr√£o API-only
if self._validate_dependencies(required=["component_name"]):
    # An√°lise inteligente com API (sem fallback)
    result = self.component.analyze_enhanced(data, api_mode=True)
    
    # Extens√£o de resultados se necess√°rio
    if len(optimized_df) < len(df):
        result = self._extend_results(df, result, optimization_report)
else:
    # Erro - depend√™ncias n√£o dispon√≠veis
    logger.error("‚ùå Depend√™ncias API n√£o dispon√≠veis")
    continue
```

---

## üìö **Documenta√ß√£o Adicional**

Para informa√ß√µes mais detalhadas, consulte:
- **[CLAUDE.md](CLAUDE.md)** - Instru√ß√µes para Claude Code e configura√ß√µes avan√ßadas
- **[config/](config/)** - Arquivos de configura√ß√£o espec√≠ficos
- **[src/dashboard/README.md](src/dashboard/README.md)** - Setup do dashboard
- **[SECURITY_SETUP.md](SECURITY_SETUP.md)** - Configura√ß√£o de seguran√ßa

---

## üìÑ **Licen√ßa e Uso Acad√™mico**

Este projeto √© destinado para **pesquisa acad√™mica** sobre:
- Comunica√ß√£o pol√≠tica digital
- An√°lise de discurso autorit√°rio
- Desinforma√ß√£o e teorias conspirat√≥rias
- Democracia digital no Brasil

---

**Pipeline Bolsonarismo v4.9.1** - Sistema completo de an√°lise cient√≠fica de discurso pol√≠tico brasileiro com intelig√™ncia artificial, otimizado para m√°xima qualidade e economia de custos.